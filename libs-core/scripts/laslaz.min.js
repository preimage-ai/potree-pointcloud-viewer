!function(t){"use strict";var e={0:function(t){return{position:[t.getInt32(0,!0),t.getInt32(4,!0),t.getInt32(8,!0)],intensity:t.getUint16(12,!0),classification:t.getUint8(16,!0)}},1:function(t){return{position:[t.getInt32(0,!0),t.getInt32(4,!0),t.getInt32(8,!0)],intensity:t.getUint16(12,!0),classification:t.getUint8(16,!0)}},2:function(t){return{position:[t.getInt32(0,!0),t.getInt32(4,!0),t.getInt32(8,!0)],intensity:t.getUint16(12,!0),classification:t.getUint8(16,!0),color:[t.getUint16(20,!0),t.getUint16(22,!0),t.getUint16(24,!0)]}},3:function(t){return{position:[t.getInt32(0,!0),t.getInt32(4,!0),t.getInt32(8,!0)],intensity:t.getUint16(12,!0),classification:t.getUint8(16,!0),color:[t.getUint16(28,!0),t.getUint16(30,!0),t.getUint16(32,!0)]}}};function r(t,e,r,n){n=void 0===n||0===n?1:n;var o=new e(t.slice(r,r+e.BYTES_PER_ELEMENT*n));if(void 0===n||1===n)return o[0];for(var i=[],a=0;a<n;a++)i.push(o[a]);return i}var n={};t.handleMessage=function(t){var e=t.data,r=n[e.id];delete n[e.id],setTimeout((function(){return e.error?r.reject(new Error(e.message||"Unknown Error")):e.hasOwnProperty("count")&&e.hasOwnProperty("hasMoreData")?r.resolve({buffer:e.result,count:e.count,hasMoreData:e.hasMoreData}):void r.resolve(e.result)}),0)};var o=function(t){this.arraybuffer=t};o.prototype.open=function(){return this.readOffset=0,new Promise((function(t,e){setTimeout(t,0)}))},o.prototype.getHeader=function(){var t=this;return new Promise((function(e,n){setTimeout((function(){t.header=function(t){var e={};e.pointsOffset=r(t,Uint32Array,96),e.pointsFormatId=r(t,Uint8Array,104),e.pointsStructSize=r(t,Uint16Array,105),e.pointsCount=r(t,Uint32Array,107);var n=131;e.scale=r(t,Float64Array,n,3),n+=24,e.offset=r(t,Float64Array,n,3),n+=24;var o=r(t,Float64Array,n,6);return n+=48,e.maxs=[o[0],o[2],o[4]],e.mins=[o[1],o[3],o[5]],e}(t.arraybuffer),e(t.header)}),0)}))},o.prototype.readData=function(t,e,r){var n=this;return new Promise((function(e,o){setTimeout((function(){if(!n.header)return o(new Error("Cannot start reading data till a header request is issued"));var i;if(r<=1){t=Math.min(t,n.header.pointsCount-n.readOffset);var a=(i=n.header.pointsOffset+n.readOffset*n.header.pointsStructSize)+t*n.header.pointsStructSize;e({buffer:n.arraybuffer.slice(i,a),count:t,hasMoreData:n.readOffset+t<n.header.pointsCount}),n.readOffset+=t}else{for(var s=Math.min(t*r,n.header.pointsCount-n.readOffset),f=Math.ceil(s/r),u=0,d=new Uint8Array(f*n.header.pointsStructSize),h=0;h<s;h++){if(h%r==0){i=n.header.pointsOffset+n.readOffset*n.header.pointsStructSize;var c=new Uint8Array(n.arraybuffer,i,n.header.pointsStructSize);d.set(c,u*n.header.pointsStructSize),u++}n.readOffset++}e({buffer:d.buffer,count:u,hasMoreData:n.readOffset<n.header.pointsCount})}}),0)}))},o.prototype.close=function(){var t=this;return new Promise((function(e,r){t.arraybuffer=null,setTimeout(e,0)}))};var i=function(t){this.arraybuffer=t;let e=Potree.scriptPath+"/workers/LASLAZWorker.js";this.ww=Potree.workerPool.getWorker(e),this.nextCB=null;var r=this;this.ww.onmessage=function(t){null!==r.nextCB&&(r.nextCB(t.data),r.nextCB=null)},this.dorr=function(t,e){r.nextCB=e,r.ww.postMessage(t)}};i.prototype.open=function(){var t=this;return new Promise((function(e,r){t.dorr({type:"open",arraybuffer:t.arraybuffer},(function(t){if(1!==t.status)return r(new Error("Failed to open file"));e(!0)}))}))},i.prototype.getHeader=function(){var t=this;return new Promise((function(e,r){t.dorr({type:"header"},(function(t){if(1!==t.status)return r(new Error("Failed to get header"));e(t.header)}))}))},i.prototype.readData=function(t,e,r){var n=this;return new Promise((function(o,i){n.dorr({type:"read",count:t,offset:e,skip:r},(function(t){if(1!==t.status)return i(new Error("Failed to read data"));o({buffer:t.buffer,count:t.count,hasMoreData:t.hasMoreData})}))}))},i.prototype.close=function(){var t=this;return new Promise((function(e,r){t.dorr({type:"close"},(function(n){let o=Potree.scriptPath+"/workers/LASLAZWorker.js";if(Potree.workerPool.returnWorker(o,t.ww),1!==n.status)return r(new Error("Failed to close file"));e(!0)}))}))};var a=function(t){if(this.arraybuffer=t,this.determineVersion(),this.version>12)throw new Error("Only file versions <= 1.2 are supported at this time");if(this.determineFormat(),void 0===e[this.formatId])throw new Error("The point format ID is not supported");this.loader=this.isCompressed?new i(this.arraybuffer):new o(this.arraybuffer)};a.prototype.determineFormat=function(){var t=r(this.arraybuffer,Uint8Array,104),e=(128&t)>>7,n=(64&t)>>6;if(1===e&&1===n)throw new Error("Old style compression not supported");this.formatId=63&t,this.isCompressed=1===e||1===n},a.prototype.determineVersion=function(){var t=new Int8Array(this.arraybuffer,24,2);this.version=10*t[0]+t[1],this.versionAsString=t[0]+"."+t[1]},a.prototype.open=function(){return this.loader.open()},a.prototype.getHeader=function(){return this.loader.getHeader()},a.prototype.readData=function(t,e,r){return this.loader.readData(t,e,r)},a.prototype.close=function(){return this.loader.close()};var s=function(t,r,n,o,i,a,s,f){this.arrayb=t,this.decoder=e[r],this.pointsCount=o,this.pointSize=n,this.scale=i,this.offset=a,this.mins=s,this.maxs=f};s.prototype.getPoint=function(t){if(t<0||t>=this.pointsCount)throw new Error("Point index out of range");var e=new DataView(this.arrayb,t*this.pointSize,this.pointSize);return this.decoder(e)},t.LAZLoader=i,t.LASLoader=o,t.LASFile=a,t.LASDecoder=s,t.LASModuleWasLoaded=!1}(this);